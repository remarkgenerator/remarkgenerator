<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ওয়ারিশন সনদ — Auto PDF</title>

<!-- pdfMake -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

<!-- NotoSansBengali Base64 font -->
<script>
pdfMake.fonts = {
    NotoSansBengali: {
        normal: 'NotoSansBengali-Regular.ttf',
        bold: 'NotoSansBengali-Regular.ttf',
        italics: 'NotoSansBengali-Regular.ttf',
        bolditalics: 'NotoSansBengali-Regular.ttf'
    }
};

// ফন্টকে vfs-এ লোড (তুমি নিজের TTF ফাইল base64 কনভার্ট করে দিতে পারো)
pdfMake.vfs['NotoSansBengali-Regular.ttf'] = `PUT-YOUR-BASE64-TTF-HERE`;
</script>

<style>
body { font-family: "Noto Sans Bengali", Arial, sans-serif; background:#f3f4f6; margin:0; padding:20px; }
.container { max-width:900px; margin:0 auto; background:#fff; padding:18px; border-radius:8px; box-shadow:0 2px 10px rgba(0,0,0,0.06); }
h1 { text-align:center; }
label { font-weight:700; display:block; margin-top:8px; }
input, textarea { width:100%; padding:8px; border:1px solid #ddd; border-radius:4px; }
button { background:#0b5ed7; color:#fff; padding:8px 12px; border:none; border-radius:6px; cursor:pointer; margin-top:12px; }
table { width:100%; border-collapse:collapse; margin-top:10px; }
th, td { border:1px solid #ccc; padding:6px; }
</style>
</head>
<body>
<div class="container">
<h1>ওয়ারিশন সনদ ফর্ম</h1>

<form id="warishForm">
<label>ফর্ম নাম</label>
<input name="formName" type="text" value="বিভাগ জেলা ও পৌরসভার নাম লিখুন" required>

<label>মৃত ব্যক্তির নাম</label>
<input name="deceasedName" type="text" required>

<label>পিতা/স্বামী</label>
<input name="fatherName" type="text" required>

<label>মহল্লা</label>
<input name="mohalla" type="text" required>

<label>ওয়ার্ড নং</label>
<input name="ward" type="text" required>

<label>ডাকঘর</label>
<input name="postOffice" type="text" required>

<label>উপজেলা/থানা</label>
<input name="thana" type="text" required>

<label>জেলা</label>
<input name="district" type="text" required>

<h3>ওয়ারিশদের তালিকা</h3>
<table id="heirsTable">
<thead>
<tr><th>ক্রমিক</th><th>নাম</th><th>বয়স</th><th>সম্পর্ক</th><th>মন্তব্য</th></tr>
</thead>
<tbody></tbody>
</table>
<button type="button" id="addHeir">+ ওয়ারিশ যোগ করুন</button>

<label>আপনার ফোন</label>
<input name="phone" type="text">

<label>আপনার ইমেইল</label>
<input name="email" type="text">

<button type="submit">Submit and Generate PDF</button>
</form>
</div>

<script>
function bnNumber(num){
    return String(num).replace(/\d/g, d=>"০১২৩৪৫৬৭৮৯"[d]);
}
function bnDate(){
    const d=new Date();
    return `${bnNumber(d.getDate())}/${bnNumber(d.getMonth()+1)}/${bnNumber(d.getFullYear())}`;
}
function generateRef(){
    const t = Date.now().toString().slice(-6);
    const r = Math.floor(Math.random()*9000)+1000;
    return `WF-${t}-${r}`;
}
function addRow(){
    const tbody = document.querySelector("#heirsTable tbody");
    const tr = document.createElement("tr");
    tr.innerHTML = `<td></td>
        <td><input type="text" class="h-name"></td>
        <td><input type="text" class="h-age"></td>
        <td><input type="text" class="h-rel"></td>
        <td><input type="text" class="h-note"></td>`;
    tbody.appendChild(tr);
    updateSerials();
}
function updateSerials(){
    document.querySelectorAll("#heirsTable tbody tr").forEach((tr,i)=>{
        tr.children[0].textContent = bnNumber(i+1);
    });
}

document.getElementById("addHeir").addEventListener("click", addRow);
addRow();

document.getElementById("warishForm").addEventListener("submit", function(e){
    e.preventDefault();

    const fd = new FormData(this);
    const data = {};
    fd.forEach((v,k)=> data[k] = v.trim());

    data.heirs = [];
    document.querySelectorAll("#heirsTable tbody tr").forEach(tr=>{
        const name = tr.querySelector(".h-name").value.trim();
        if(!name) return;
        data.heirs.push({
            name,
            age: tr.querySelector(".h-age").value.trim(),
            rel: tr.querySelector(".h-rel").value.trim(),
            note: tr.querySelector(".h-note").value.trim()
        });
    });

    data.ref = generateRef();

    // PDF content
    const docDef = {
        defaultStyle: { font: 'NotoSansBengali', fontSize: 11 },
        content: [
            { text: data.formName, style: 'header', alignment: 'center' },
            { text: `রেফারেন্স: ${data.ref}`, margin:[0,10,0,0] },
            { text: `তারিখ: ${bnDate()}`, margin:[0,0,0,10] },

            { text: 'মৃত ব্যক্তির তথ্য:', bold:true, margin:[0,5,0,3] },
            { text: `নাম: ${data.deceasedName}` },
            { text: `পিতা/স্বামী: ${data.fatherName}` },
            { text: `মহল্লা: ${data.mohalla}` },
            { text: `ওয়ার্ড: ${data.ward}` },
            { text: `ডাকঘর: ${data.postOffice}` },
            { text: `উপজেলা/থানা: ${data.thana}` },
            { text: `জেলা: ${data.district}`, margin:[0,0,0,10] },

            { text: 'ওয়ারিশদের তালিকা:', bold:true, margin:[0,5,0,3] },
            {
                table: {
                    widths: ['auto','*','auto','auto','*'],
                    body: [
                        ['ক্রমিক','নাম','বয়স','সম্পর্ক','মন্তব্য'],
                        ...data.heirs.map((h,i)=>[
                            bnNumber(i+1), h.name, h.age, h.rel, h.note
                        ])
                    ]
                }
            },
            { text: '\nস্বাক্ষর: ______________________', margin:[0,20,0,0] },
            { text: `ফোন: ${data.phone || ''}   ইমেইল: ${data.email || ''}`, margin:[0,10,0,0] }
        ],
        styles: {
            header: { fontSize: 16, bold: true }
        }
    };

    pdfMake.createPdf(docDef).download(`${data.ref}_warish.pdf`);
});
</script>
</body>
</html>
