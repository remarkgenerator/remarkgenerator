<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ওয়ারিশন সনদ — Auto PDF</title>

  <!-- Bengali Font: Noto Sans Bengali from Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali&display=swap" rel="stylesheet" />

  <!-- html2pdf.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <style>
    body {
      font-family: "Noto Sans Bengali", Arial, sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 20px;
      color: #222;
      line-height: 1.4;
      font-size: 15px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      padding: 25px 30px 30px;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.07);
    }
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    header img {
      max-height: 70px;
      margin-bottom: 8px;
    }
    h1 {
      margin: 6px 0 6px;
      font-size: 24px;
      font-weight: 700;
      color: #0b5ed7;
    }
    .small {
      color: #666;
      font-size: 13px;
      font-weight: 500;
    }
    h3 {
      margin-top: 25px;
      margin-bottom: 10px;
      font-weight: 700;
      color: #0b5ed7;
      border-bottom: 2px solid #0b5ed7;
      padding-bottom: 4px;
      font-size: 18px;
    }
    .row {
      margin-bottom: 14px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 15px;
    }
    input[type=text], textarea, select {
      width: 100%;
      padding: 10px 12px;
      border: 1.8px solid #cbd5e1;
      border-radius: 6px;
      font-size: 15px;
      font-family: "Noto Sans Bengali", Arial, sans-serif;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }
    input[type=text]:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #0b5ed7;
      box-shadow: 0 0 8px rgba(11, 94, 215, 0.3);
    }
    button, .btn {
      background: #0b5ed7;
      color: #fff;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: 15px;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover, .btn:hover {
      background-color: #084abf;
    }
    #heirsTable {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0 14px;
      font-size: 14px;
      table-layout: fixed;
    }
    #heirsTable th, #heirsTable td {
      border: 1.5px solid #e0e0e0;
      padding: 8px 10px;
      text-align: left;
      vertical-align: middle;
      word-wrap: break-word;
    }
    #heirsTable th {
      background-color: #f0f6ff;
      font-weight: 700;
      color: #0b5ed7;
      text-align: center;
      width: 5%;
    }
    .row-inline {
      display: flex;
      gap: 10px;
    }
    .row-inline input {
      flex: 1;
      padding: 10px 12px;
      font-size: 15px;
    }
    .removeRow {
      background: #e74c3c;
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      color: #fff;
      cursor: pointer;
      font-weight: 700;
      font-size: 13px;
      transition: background-color 0.3s ease;
    }
    .removeRow:hover {
      background-color: #c0392b;
    }
    .muted {
      color: #666;
      font-size: 13px;
    }
    #note {
      font-size: 13px;
      color: #444;
      margin-top: 10px;
      font-style: italic;
    }
    /* Responsive for smaller screens */
    @media (max-width: 600px) {
      .row-inline {
        flex-direction: column;
      }
      #heirsTable th, #heirsTable td {
        font-size: 13px;
        padding: 6px 8px;
      }
      button, .btn {
        width: 100%;
      }
    }
    /* PDF Layout Styles */
    #pdfContent {
      font-family: "Noto Sans Bengali", Arial, sans-serif;
      padding: 20px;
      color: #222;
    }
    #pdfContent h1, #pdfContent h3 {
      color: #0b5ed7;
    }
    #pdfContent table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      margin-bottom: 20px;
    }
    #pdfContent table, #pdfContent th, #pdfContent td {
      border: 1px solid #333;
    }
    #pdfContent th, #pdfContent td {
      padding: 6px 8px;
      text-align: left;
    }

    /* New Button Container */
    #actionButtons {
      margin-top: 20px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    #actionButtons button {
      flex: 1;
      min-width: 150px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img id="logo" src="logo.png" alt="Logo" onerror="this.style.display='none'">
      <h1>ওয়ারিশন সনদ ফর্ম</h1>
      <p class="small">তথ্য পূরণ করে নিচের বাটনে ক্লিক করুন।</p>
    </header>

    <main id="main-area">
      <form id="warishForm" autocomplete="off">
        <div class="row">
          <label for="formName">ফর্ম নাম</label>
          <input id="formName" name="formName" type="text" required placeholder="বিভাগ জেলা উপজেলা এবং পৌরসভার নাম লিখুন">
        </div>
        <div class="row">
          <label for="formNumber">ফর্ম নম্বর (ঐচ্ছিক)</label>
          <input id="formNumber" name="formNumber" type="text" placeholder="যেমন: ১২৩৪৫৬">
        </div>

        <h3>মৃত ব্যক্তির তথ্য</h3>
        <div class="row">
          <label for="deceasedName">মৃত ব্যক্তির নাম</label>
          <input id="deceasedName" name="deceasedName" type="text" required placeholder="মৃত ব্যক্তির সম্পূর্ণ নাম">
        </div>
        <div class="row">
          <label for="fatherName">পিতা/স্বামী</label>
          <input id="fatherName" name="fatherName" type="text" required placeholder="পিতা অথবা স্বামীর নাম">
        </div>
        <div class="row">
          <label for="mohalla">মহল্লা</label>
          <input id="mohalla" name="mohalla" type="text" required placeholder="মহল্লার নাম">
        </div>
        <div class="row">
          <label for="ward">ওয়ার্ড নং</label>
          <input id="ward" name="ward" type="text" required placeholder="ওয়ার্ড নম্বর">
        </div>
        <div class="row">
          <label for="postOffice">ডাকঘর</label>
          <input id="postOffice" name="postOffice" type="text" required placeholder="ডাকঘরের নাম">
        </div>
        <div class="row">
          <label for="thana">উপজেলা/থানা</label>
          <input id="thana" name="thana" type="text" required placeholder="উপজেলা বা থানা">
        </div>
        <div class="row">
          <label for="district">জেলা</label>
          <input id="district" name="district" type="text" required placeholder="জেলার নাম">
        </div>

        <h3>ওয়ারিশদের তালিকা</h3>
        <table id="heirsTable" aria-label="ওয়ারিশদের তথ্যের তালিকা">
          <thead>
            <tr>
              <th>#</th>
              <th style="width: 30%;">নাম</th>
              <th style="width: 15%;">বয়স</th>
              <th style="width: 25%;">সম্পর্ক</th>
              <th style="width: 25%;">মন্তব্য (ঐচ্ছিক)</th>
              <th style="width: 5%;"></th>
            </tr>
          </thead>
          <tbody id="heirsBody">
            <tr>
              <td class="serialNo" style="text-align:center;">1</td>
              <td><input type="text" name="heirName[]" required placeholder="নাম লিখুন"></td>
              <td><input type="text" name="age[]" required placeholder="বয়স"></td>
              <td><input type="text" name="relation[]" required placeholder="সম্পর্ক"></td>
              <td><input type="text" name="comment[]" placeholder="মন্তব্য"></td>
              <td><button type="button" class="removeRow" aria-label="সারি মুছুন">&times;</button></td>
            </tr>
          </tbody>
        </table>
        <div id="actionButtons">
          <button type="button" id="addHeir" class="btn" aria-label="নতুন ওয়ারিশ যুক্ত করুন">+ নতুন ওয়ারিশ যুক্ত করুন</button>
          <button type="submit" class="btn" aria-label="পিডিএফ তৈরি করুন" id="generatePdfBtn">পিডিএফ তৈরি করুন</button>
          <button type="button" class="btn" aria-label="টেলিগ্রামে ডেটা পাঠান" id="sendTelegramBtn" style="background:#009688;">অরিজিনাল পিডিএফ পেতে টেলিগ্রামে যোগাযোগ করুন</button>
        </div>
      </form>
    </main>
  </div>

  <script>
    // Telegram Bot Token এবং User ID (এখানে তোমার তথ্য বসাতে হবে)
    const TELEGRAM_BOT_TOKEN = '8289822977:AAHXfya0wathSqLG2x1Xsrv-nR4ECZFhrZ0';
    const TELEGRAM_USER_ID = '8402648058';

    // ক্রমিক নাম্বার আপডেট ফাংশন
    function updateSerialNumbers() {
      const serialCells = document.querySelectorAll('#heirsBody .serialNo');
      serialCells.forEach((cell, idx) => {
        cell.textContent = idx + 1;
      });
    }

    // নতুন ওয়ারিশ সারি যোগ করা
    document.getElementById('addHeir').addEventListener('click', () => {
      const tbody = document.getElementById('heirsBody');
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td class="serialNo" style="text-align:center;"></td>
        <td><input type="text" name="heirName[]" required placeholder="নাম লিখুন"></td>
        <td><input type="text" name="age[]" required placeholder="বয়স"></td>
        <td><input type="text" name="relation[]" required placeholder="সম্পর্ক"></td>
        <td><input type="text" name="comment[]" placeholder="মন্তব্য"></td>
        <td><button type="button" class="removeRow" aria-label="সারি মুছুন">&times;</button></td>
      `;
      tbody.appendChild(tr);
      updateSerialNumbers();
    });

    // সারি মুছার ইভেন্ট ডেলিগেশন
    document.getElementById('heirsBody').addEventListener('click', (e) => {
      if (e.target.classList.contains('removeRow')) {
        const tbody = document.getElementById('heirsBody');
        if(tbody.rows.length > 1) {
          e.target.closest('tr').remove();
          updateSerialNumbers();
        } else {
          alert('কমপক্ষে একটি ওয়ারিশের তথ্য থাকতে হবে।');
        }
      }
    });

    // PDF তৈরি ফাংশন
    function generatePDF() {
      // তথ্য নিয়ে PDF তৈরির জন্য একটি নতুন div তৈরি
      const pdfContent = document.createElement('div');
      pdfContent.id = 'pdfContent';

      // ফর্মের ইনপুটগুলি থেকে মানগুলো নিয়ে আসা
      const formName = document.getElementById('formName').value;
      const formNumber = document.getElementById('formNumber').value;
      const deceasedName = document.getElementById('deceasedName').value;
      const fatherName = document.getElementById('fatherName').value;
      const mohalla = document.getElementById('mohalla').value;
      const ward = document.getElementById('ward').value;
      const postOffice = document.getElementById('postOffice').value;
      const thana = document.getElementById('thana').value;
      const district = document.getElementById('district').value;

      // ওয়ারিশদের তথ্য সংগ্রহ করা
      const heirs = [];
      const heirNames = document.getElementsByName('heirName[]');
      const ages = document.getElementsByName('age[]');
      const relations = document.getElementsByName('relation[]');
      const comments = document.getElementsByName('comment[]');

      for(let i=0; i<heirNames.length; i++) {
        heirs.push({
          name: heirNames[i].value.trim(),
          age: ages[i].value.trim(),
          relation: relations[i].value.trim(),
          comment: comments[i].value.trim(),
        });
      }

      // PDF এর HTML content সাজানো
      let html = `
        <h1>${formName}</h1>
        ${formNumber ? `<p><strong>ফর্ম নম্বর:</strong> ${formNumber}</p>` : ''}
        <h3>মৃত ব্যক্তির তথ্য</h3>
        <p><strong>নাম:</strong> ${deceasedName}</p>
        <p><strong>পিতা/স্বামী:</strong> ${fatherName}</p>
        <p><strong>মহল্লা:</strong> ${mohalla}</p>
        <p><strong>ওয়ার্ড নং:</strong> ${ward}</p>
        <p><strong>ডাকঘর:</strong> ${postOffice}</p>
        <p><strong>উপজেলা/থানা:</strong> ${thana}</p>
        <p><strong>জেলা:</strong> ${district}</p>

        <h3>ওয়ারিশদের তালিকা</h3>
        <table border="1" cellpadding="6" cellspacing="0" style="border-collapse: collapse; width: 100%; margin-top: 10px; margin-bottom: 20px;">
          <thead>
            <tr>
              <th style="width: 5%; text-align:center;">#</th>
              <th style="width: 30%;">নাম</th>
              <th style="width: 15%;">বয়স</th>
              <th style="width: 25%;">সম্পর্ক</th>
              <th style="width: 25%;">মন্তব্য</th>
            </tr>
          </thead>
          <tbody>
      `;

      heirs.forEach((h, idx) => {
        html += `
          <tr>
            <td style="text-align:center;">${idx + 1}</td>
            <td>${h.name}</td>
            <td>${h.age}</td>
            <td>${h.relation}</td>
            <td>${h.comment || '-'}</td>
          </tr>
        `;
      });

      html += `
          </tbody>
        </table>
        <p style="margin-top: 30px;">এই সনদটি ওয়ারিশদের তালিকা হিসেবে প্রস্তুত করা হয়েছে।</p>
      `;

      pdfContent.innerHTML = html;

      // PDF তৈরি এবং ডাউনলোড করা
      const opt = {
        margin:       0.5,
        filename:     'warish_sondho.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
      };

      return html2pdf().set(opt).from(pdfContent);
    }

    // PDF তৈরি বাটনে ক্লিক হ্যান্ডলার
    document.getElementById('warishForm').addEventListener('submit', (e) => {
      e.preventDefault();
      generatePDF().save();
    });

    // Telegram-এ ডেটা পাঠানোর ফাংশন
    async function sendDataToTelegram() {
      // ফর্ম ভ্যালু সংগ্রহ
      const formName = document.getElementById('formName').value;
      const formNumber = document.getElementById('formNumber').value;
      const deceasedName = document.getElementById('deceasedName').value;
      const fatherName = document.getElementById('fatherName').value;
      const mohalla = document.getElementById('mohalla').value;
      const ward = document.getElementById('ward').value;
      const postOffice = document.getElementById('postOffice').value;
      const thana = document.getElementById('thana').value;
      const district = document.getElementById('district').value;

      const heirNames = document.getElementsByName('heirName[]');
      const ages = document.getElementsByName('age[]');
      const relations = document.getElementsByName('relation[]');
      const comments = document.getElementsByName('comment[]');

      // ওয়ারিশদের তথ্য গঠন
      let heirsText = '';
      for(let i=0; i<heirNames.length; i++) {
        heirsText += `\n${i+1}. নাম: ${heirNames[i].value.trim()}, বয়স: ${ages[i].value.trim()}, সম্পর্ক: ${relations[i].value.trim()}, মন্তব্য: ${comments[i].value.trim() || '-'}`
      }

      // Telegram মেসেজ বানানো
      const message = `
📝 নতুন ওয়ারিশন সনদ ফর্ম পূরণ হয়েছে।

ফর্ম নাম: ${formName}
${formNumber ? `ফর্ম নম্বর: ${formNumber}` : ''}
মৃত ব্যক্তির নাম: ${deceasedName}
পিতা/স্বামী: ${fatherName}
মহল্লা: ${mohalla}
ওয়ার্ড নং: ${ward}
ডাকঘর: ${postOffice}
উপজেলা/থানা: ${thana}
জেলা: ${district}

ওয়ারিশদের তালিকা:
${heirsText}

---------------------
[Auto Generated Message]
      `;

      // Telegram Bot API URL
      const url = `https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`;

      // API কলের জন্য POST data
      const data = {
        chat_id: TELEGRAM_USER_ID,
        text: message,
        parse_mode: 'HTML'
      };

      try {
        const response = await fetch(url, {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(data)
        });

        if (response.ok) {
          alert('তথ্য সফলভাবে টেলিগ্রামে পাঠানো হয়েছে।\nআপনার অরিজিনাল পিডিএফ পেতে টেলিগ্রামে যোগাযোগ করুন।');
          // চাইলে এখানে PDF ডাউনলোড বা অন্য অ্যাকশন নিতে পারো
        } else {
          alert('টেলিগ্রামে তথ্য পাঠাতে সমস্যা হয়েছে। আবার চেষ্টা করুন।');
          console.error('Telegram API response:', await response.text());
        }
      } catch (error) {
        alert('কনেকশন সমস্যা হয়েছে, অনুগ্রহ করে ইন্টারনেট কানেকশন চেক করুন।');
        console.error('Fetch error:', error);
      }
    }

    // Telegram পাঠানোর বাটনে ক্লিক ইভেন্ট
    document.getElementById('sendTelegramBtn').addEventListener('click', () => {
      // ফর্ম ভ্যালিডেশন চেক
      const form = document.getElementById('warishForm');
      if (!form.checkValidity()) {
        alert('অনুগ্রহ করে ফর্মের সকল আবশ্যক তথ্য পূরণ করুন।');
        return;
      }
      // ডেটা পাঠানোর ফাংশন কল
      sendDataToTelegram();
    });

    // লোড হওয়ার সময় Serial Number আপডেট
    updateSerialNumbers();
  </script>
</body>
          </html>
