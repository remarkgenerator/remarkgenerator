<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ওয়ারিশন সনদ — Auto PDF</title>

  <!-- Bengali Font: Noto Sans Bengali from Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali&display=swap" rel="stylesheet" />

  <!-- jsPDF CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    body {
      font-family: "Noto Sans Bengali", Arial, sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 20px;
      color: #222;
      line-height: 1.4;
      font-size: 15px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #fff;
      padding: 25px 30px 30px;
      border-radius: 10px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.07);
    }
    header {
      text-align: center;
      margin-bottom: 20px;
    }
    header img {
      max-height: 70px;
      margin-bottom: 8px;
    }
    h1 {
      margin: 6px 0 6px;
      font-size: 24px;
      font-weight: 700;
      color: #0b5ed7;
    }
    .small {
      color: #666;
      font-size: 13px;
      font-weight: 500;
    }
    h3 {
      margin-top: 25px;
      margin-bottom: 10px;
      font-weight: 700;
      color: #0b5ed7;
      border-bottom: 2px solid #0b5ed7;
      padding-bottom: 4px;
      font-size: 18px;
    }
    .row {
      margin-bottom: 14px;
    }
    label {
      display: block;
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 15px;
    }
    input[type=text], textarea, select {
      width: 100%;
      padding: 10px 12px;
      border: 1.8px solid #cbd5e1;
      border-radius: 6px;
      font-size: 15px;
      font-family: "Noto Sans Bengali", Arial, sans-serif;
      box-sizing: border-box;
      transition: border-color 0.3s ease;
    }
    input[type=text]:focus, textarea:focus, select:focus {
      outline: none;
      border-color: #0b5ed7;
      box-shadow: 0 0 8px rgba(11, 94, 215, 0.3);
    }
    button, .btn {
      background: #0b5ed7;
      color: #fff;
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 700;
      font-size: 15px;
      transition: background-color 0.3s ease;
      user-select: none;
    }
    button:hover, .btn:hover {
      background-color: #084abf;
    }
    #heirsTable {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0 14px;
      font-size: 14px;
      table-layout: fixed;
    }
    #heirsTable th, #heirsTable td {
      border: 1.5px solid #e0e0e0;
      padding: 8px 10px;
      text-align: left;
      vertical-align: middle;
      word-wrap: break-word;
    }
    #heirsTable th {
      background-color: #f0f6ff;
      font-weight: 700;
      color: #0b5ed7;
    }
    .row-inline {
      display: flex;
      gap: 10px;
    }
    .row-inline input {
      flex: 1;
      padding: 10px 12px;
      font-size: 15px;
    }
    .removeRow {
      background: #e74c3c;
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      color: #fff;
      cursor: pointer;
      font-weight: 700;
      font-size: 13px;
      transition: background-color 0.3s ease;
    }
    .removeRow:hover {
      background-color: #c0392b;
    }
    .muted {
      color: #666;
      font-size: 13px;
    }
    #note {
      font-size: 13px;
      color: #444;
      margin-top: 10px;
      font-style: italic;
    }
    /* Responsive for smaller screens */
    @media (max-width: 600px) {
      .row-inline {
        flex-direction: column;
      }
      #heirsTable th, #heirsTable td {
        font-size: 13px;
        padding: 6px 8px;
      }
      button, .btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <img id="logo" src="logo.png" alt="Logo" onerror="this.style.display='none'">
      <h1>ওয়ারিশন সনদ ফর্ম</h1>
      <p class="small">তথ্য পূরণ করে Submit দিলে পিডিএফ স্বয়ংক্রিয়ভাবে ডাউনলোড হবে।</p>
    </header>

    <main id="main-area">
      <form id="warishForm" autocomplete="off">
        <div class="row">
          <label for="formName">ফর্ম নাম</label>
          <input id="formName" name="formName" type="text" value="বিভাগ জেলা ও পওরসভার নাম লিখুন" required>
        </div>
        <div class="row">
          <label for="formNumber">ফর্ম নম্বর (ঐচ্ছিক)</label>
          <input id="formNumber" name="formNumber" type="text" placeholder="যেমন: ১২৩৪৫৬">
        </div>

        <h3>মৃত ব্যক্তির তথ্য</h3>
        <div class="row">
          <label for="deceasedName">মৃত ব্যক্তির নাম</label>
          <input id="deceasedName" name="deceasedName" type="text" required placeholder="মৃত ব্যক্তির সম্পূর্ণ নাম">
        </div>
        <div class="row">
          <label for="fatherName">পিতা/স্বামী</label>
          <input id="fatherName" name="fatherName" type="text" required placeholder="পিতা অথবা স্বামীর নাম">
        </div>
        <div class="row">
          <label for="mohalla">মহল্লা</label>
          <input id="mohalla" name="mohalla" type="text" required placeholder="মহল্লার নাম">
        </div>
        <div class="row">
          <label for="ward">ওয়ার্ড নং</label>
          <input id="ward" name="ward" type="text" required placeholder="ওয়ার্ড নম্বর">
        </div>
        <div class="row">
          <label for="postOffice">ডাকঘর</label>
          <input id="postOffice" name="postOffice" type="text" required placeholder="ডাকঘরের নাম">
        </div>
        <div class="row">
          <label for="thana">উপজেলা/থানা</label>
          <input id="thana" name="thana" type="text" required placeholder="উপজেলা বা থানা">
        </div>
        <div class="row">
          <label for="district">জেলা</label>
          <input id="district" name="district" type="text" required placeholder="জেলার নাম">
        </div>

        <h3>ওয়ারিশদের তালিকা</h3>
        <table id="heirsTable" aria-label="ওয়ারিশদের তথ্যের তালিকা">
          <thead>
            <tr>
              <th style="width:5%;">ক্রমিক নং</th>
              <th style="width:35%;">নাম</th>
              <th style="width:15%;">বয়স</th>
              <th style="width:20%;">সম্পর্ক</th>
              <th style="width:20%;">মন্তব্য</th>
              <th style="width:5%;"></th>
            </tr>
          </thead>
          <tbody>
            <!-- ওয়ারিশের সারি এখানে ডায়নামিকলি যোগ হবে -->
          </tbody>
        </table>
        <div style="margin-bottom: 15px;">
          <button type="button" id="addHeirBtn" class="btn">+ ওয়ারিশ যোগ করুন</button>
        </div>

        <div class="row">
          <label for="phone">আপনার ফোন (PDF এ রাখা যাবে)</label>
          <input id="phone" name="phone" type="text" placeholder="০১XXXXXXXXX" >
        </div>
        <div class="row">
          <label for="email">আপনার ইমেইল (ঐচ্ছিক)</label>
          <input id="email" name="email" type="text" placeholder="example@mail.com" >
        </div>

        <div class="row" style="margin-top: 18px;">
          <button type="submit" id="submitBtn">Submit and Generate PDF</button>
        </div>

        <p id="note">নোট: এখানে Submit দিলে পিডিএফ ব্রাউজার থেকেই ডাউনলোড হবে। (তবে অরিজিনাল ফাইল পেতে পেমেন্ট ভেরিফাই করে টেলিগ্রাম এ যোগাযোগ করুন)</p>
      </form>
    </main>
  </div>

  <script>
  // ---------------- Utilities ----------------
  function generateRef() {
    const t = Date.now().toString().slice(-6);
    const r = Math.floor(Math.random() * 9000) + 1000;
    return 'WF-' + t + '-' + r;
  }

  function addHeirRow(name = '', age = '', rel = '', note = '') {
    const tbody = document.querySelector('#heirsTable tbody');
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="serial"></td>
      <td><input class="h-name" type="text" value="${(name || '').replace(/"/g, '&quot;')}" placeholder="নাম" required></td>
      <td><input class="h-age" type="text" value="${(age || '').replace(/"/g, '&quot;')}" placeholder="বয়স" ></td>
      <td><input class="h-rel" type="text" value="${(rel || '').replace(/"/g, '&quot;')}" placeholder="সম্পর্ক" ></td>
      <td><input class="h-note" type="text" value="${(note || '').replace(/"/g, '&quot;')}" placeholder="মন্তব্য" ></td>
      <td><button type="button" class="removeRow" aria-label="ওয়ারিশ মুছে ফেলুন">Remove</button></td>`;
    tbody.appendChild(tr);
    tr.querySelector('.removeRow').addEventListener('click', () => {
      tr.remove();
      updateSerials();
    });
    updateSerials();
  }

  function updateSerials() {
    document.querySelectorAll('#heirsTable tbody tr').forEach((tr, i) => {
      const cell = tr.querySelector('.serial');
      if (cell) cell.textContent = String(i + 1).padStart(2, '0');
    });
  }

  // ---------------- PDF Generation ----------------
  async function generatePDF(data) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF('p', 'pt', 'a4');
    const margin = 40;
    let y = 40;

    // Load logo.png if present
    async function addLogo() {
      return new Promise((res) => {
        const img = new Image();
        img.src = './logo.png';
        img.onload = function () {
          try {
            doc.addImage(img, 'PNG', margin, y, 80, 50);
            y += 60;
          } catch (e) { }
          res();
        };
        img.onerror = function () { res(); };
      });
    }
    await addLogo();

    doc.setFontSize(16);
    doc.setFont('NotoSansBengali', 'normal'); // set font if embedded (see note below)
    doc.text(data.formName || 'ওয়ারিশন সনদ', doc.internal.pageSize.getWidth() / 2, y, { align: 'center' });
    y += 26;

    doc.setFontSize(10);
    doc.text(`রেফারেন্স: ${data.ref}`, margin, y); y += 16;
    doc.text(`তারিখ: ${new Date().toLocaleDateString('bn-BD')}`, margin, y); y += 20;

    // Deceased info
    doc.setFontSize(12);
    doc.text('মৃত ব্যক্তির তথ্য:', margin, y); y += 18;
    const leftColX = margin;
    const rightColX = 320;
    doc.setFontSize(10);
    doc.text(`নাম: ${data.deceasedName || ''}`, leftColX, y);
    doc.text(`পিতা/স্বামী: ${data.fatherName || ''}`, rightColX, y); y += 16;
    doc.text(`মহল্লা: ${data.mohalla || ''}`, leftColX, y);
    doc.text(`ওয়ার্ড: ${data.ward || ''}`, rightColX, y); y += 16;
    doc.text(`ডাকঘর: ${data.postOffice || ''}`, leftColX, y);
    doc.text(`উপজেলা/থানা: ${data.thana || ''}`, rightColX, y); y += 16;
    doc.text(`জেলা: ${data.district || ''}`, leftColX, y); y += 24;

    // Heirs header
    doc.setFontSize(12);
    doc.text('ওয়ারিশদের তালিকা:', margin, y); y += 18;
    doc.setFontSize(10);

    // Table-like layout
    const lineHeight = 16;
    const col1 = margin;       // serial
    const col2 = margin + 30;  // name
    const col3 = margin + 260; // age
    const col4 = margin + 310; // rel
    const col5 = margin + 400; // note

    if ((data.heirs || []).length === 0) {
      doc.text('কোনও ওয়ারিশ তথ্য দেওয়া হয়নি।', margin, y);
      y += lineHeight;
    } else {
      for (let idx = 0; idx < data.heirs.length; idx++) {
        const h = data.heirs[idx];
        if (y > 740) { // page break if near bottom
          doc.addPage();
          y = 40;
        }
        doc.text(String(idx + 1).padStart(2, '0'), col1, y);

        // Wrap name & note text
        const nameLines = doc.splitTextToSize(h.name || '', 220);
        doc.text(nameLines, col2, y);

        doc.text(h.age || '', col3, y);
        doc.text(h.rel || '', col4, y);

        if (h.note) {
          const noteLines = doc.splitTextToSize(h.note, 150);
          doc.text(noteLines, col5, y);
          y += lineHeight * Math.max(nameLines.length, noteLines.length);
        } else {
          y += lineHeight * nameLines.length;
        }
      }
    }

    y += 24;
    doc.setFontSize(12);
    doc.text('যোগাযোগের তথ্য:', margin, y);
    y += 18;
    doc.setFontSize(10);
    doc.text(`ফোন: ${data.phone || ''}`, margin, y);
    y += 16;
    if (data.email) {
      doc.text(`ইমেইল: ${data.email}`, margin, y);
      y += 16;
    }

    y += 30;
    doc.setFontSize(9);
    doc.setTextColor("#888");
    doc.text("এই সনদ শুধুমাত্র তথ্যের স্বার্থে তৈরি। কোনো আইনি দৃষ্টিকোণ থেকে ব্যবহার করার পূর্বে প্রযোজ্য আইন পর্যালোচনা করুন।", margin, y);

    doc.save(`warishon_sondho_${data.deceasedName ? data.deceasedName.replace(/\s+/g, '_') : 'document'}.pdf`);
  }

  // --------------- Main ---------------
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('warishForm');
    const addHeirBtn = document.getElementById('addHeirBtn');

    // Add initial heir row
    addHeirRow();

    addHeirBtn.addEventListener('click', () => {
      addHeirRow();
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Collect data
      const data = {
        ref: generateRef(),
        formName: form.formName.value.trim(),
        formNumber: form.formNumber.value.trim(),
        deceasedName: form.deceasedName.value.trim(),
        fatherName: form.fatherName.value.trim(),
        mohalla: form.mohalla.value.trim(),
        ward: form.ward.value.trim(),
        postOffice: form.postOffice.value.trim(),
        thana: form.thana.value.trim(),
        district: form.district.value.trim(),
        phone: form.phone.value.trim(),
        email: form.email.value.trim(),
        heirs: []
      };

      const rows = document.querySelectorAll('#heirsTable tbody tr');
      rows.forEach(row => {
        const name = row.querySelector('.h-name').value.trim();
        if (!name) return; // skip empty
        const age = row.querySelector('.h-age').value.trim();
        const rel = row.querySelector('.h-rel').value.trim();
        const note = row.querySelector('.h-note').value.trim();
        data.heirs.push({ name, age, rel, note });
      });

      // Validate required fields
      if (!data.formName) return alert('ফর্ম নাম দিন');
      if (!data.deceasedName) return alert('মৃত ব্যক্তির নাম দিন');
      if (!data.fatherName) return alert('পিতা/স্বামী এর নাম দিন');
      if (!data.mohalla) return alert('মহল্লার নাম দিন');
      if (!data.ward) return alert('ওয়ার্ড নম্বর দিন');
      if (!data.postOffice) return alert('ডাকঘরের নাম দিন');
      if (!data.thana) return alert('উপজেলা/থানা দিন');
      if (!data.district) return alert('জেলার নাম দিন');
      if (data.heirs.length === 0) return alert('কমপক্ষে একটি ওয়ারিশের তথ্য দিন');

      // Generate PDF
      await generatePDF(data);
    });
  });
  </script>
</body>
</html>
